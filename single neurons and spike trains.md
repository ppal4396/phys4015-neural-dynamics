# single neurons and spike trains

## membrane potential

**membrane potential**: neurons have a potential difference across their cell membranes, due to concentration differences in ions that are maintained by ATP pumps (**ion pumps**).

**ion channels** allow particular ions through.

**Nernst potential**: the membrane potential at which the flow of a particular ion through open membrane channels due to a concentration gradient is nullified (by an electrical gradient in the opposite direction). Given by:
$$E_A = \frac{k_B T} {z_A q_e} \ln \frac{[A_{out}]}{[A_{in}]} $$
- $T$ is temperature, converted to units of thermal energy by Boltzmann constant $k_B$
- $z_A$ is charge (discrete) of the ion, converted to continuous electronic charge by fundamental charge of an electron $q_e$
- $A$ is the ion, subscript indicates inside or outside cell.

The force due to electrical gradient is much stronger than concentration gradient (as the electrical gradient increases, chance of an ion moving against it exponentially decreases).

Movement of ions through channels try to push the membrane potential towards their Nernst potential. However the membrane potential is continually reset by ion pumps; which create the concentration gradients and the existence of the Nernst potential in the first place.

Membrane is said to be 'polarised' because of the excess negative and positive charges building up on the inside and outside respectively.

Opening ion channels leading to positive charge flowing in is called 'depolarisation' since the imbalance in charge is reduced.

Further removal of positive charge from the cell is called 'hyperpolarisation' since imbalance in charge is increased.

## circuit model of neuronal membrane

![[circuit model of neuronal membrane.png|300]]
- capacitor represents membrane surface's ability to store charge (ions sort of build up against lipid bilayer)
- some gated ion channels are represented in parallel; each channel is a battery + resistor.
	- an effective battery is produced by high concentration gradient
	- resistor is produced by the conductance of the channel.
	- conductance is variable since the channels are gated (except for the 'leak channel')
- leaky channel at the end represents the ion pumps that charge the capacitor i.e. bring the membrane to resting potential.
- the vertical arrows are directed to show current flow when membrane potential is at 0 mV 
	- (i.e. 0 mV is above resting potential, above Nernst potential for K, and below Nernst potentials for Na, Ca)

The resting membrane potential is given when the net current through each of the channels is zero.
$$ I_m = \sum_{A} G_A (V_m - E_A) = 0$$
- We're summing the current through each ion channel $A$ here.
- $G_A$ is the channel's conductance, $E_A$ is its Nernst potential

The resting membrane potential (in the above circuit where we have Na, Ca and K channels) is given by
$$ 
V_m = 
\frac
{G_{Na}E_{Na} + G_{Ca}E_{Ca} + G_{K}E_{K} + G_{L}E_{L}}
{G_{Na} + G_{Ca} + G_{K} + G_{L}} 
$$

A model for the membrane potential's *dynamics* can be quickly derived as follows. First consider all conductances as fixed and only use the leaky channel term to model current through the membrane.
$$ I_m = G_L(V_m - E_L) $$
Since membrane potential is generated by charge $Q$ stored on the membrane (i.e. in the capacitor above) it can be modelled in relation to capacitance $C_m$.
$$ Q = C_m V_m $$
Rate of change in charge is given by current through the membrane.
$$ \frac{dQ}{dt} = - I_m = - G_L(V_m - E_L)$$
Since capacitance is fixed over time, changing membrane potential is modelled inside (combine above two equations):
$$C_m \frac{dV_m}{dt} 
= G_L (E_L - V_m) $$
Solving this to get $V_m$ as a function of time gives
$$ V_m(t) = E_L +
\left [ V_0 - E_L \right ]
\exp{(- t / \tau_m)} $$
Therefore membrane potential dynamics follow an exponential decay function, towards steady state value $E_L$. 
- Time constant $\tau_m = C_m / G_L$ 
- $V_0$ is the initial potential

The steady state value $E_L$ is typically around $-60$ to $-75$ mV. Note negative value indicates negative potential inside the cell relative to outside. 

## Hodgkin-Huxley model of conductance-based dynamics

> [!note]
> described inside Ch 4. Conductance Based Models in Miller textbook

Describes cell membrane potential as continuous dynamic system. Captures the feedback loop between membrane potential and channel conductance; modelling the appearance of single neuronal dynamics such as spikes, sub-spike-threshold oscillations, resonance  (periodic activity) and bistability (spiking vs quiet state).

Components:
- cell membrane (capacitor)
- Voltage-gated Ion channels (nonlinear conductance)
- Leaky ion channels (linear conductance)
- Electrochemical gradients driving flows of ions (voltage sources)
- Ion exchangers (current sources)

Total current through membrane is conceptualised as above; the sum of current through each channel, with the addition of experimentally applied current
$$ I_m = C_m \frac{dV_m}{dt} = \sum_A G_A (V_m - E_A) + I _{app}$$
But Hodgkin-Huxley introduces gating variables for the degree of activation of voltage-gated sodium and potassium channels.
-  $m$ (sodium activation variable)
- $h$ (sodium inactivation variable)
- $n$ (potassium inactivation variable).

Each gating variable has a voltage-dependent steady state value (would reach this value if membrane potential was fixed) and a voltage-dependent time constant (for how long it takes to reach its steady state).

Four coupled differential equations are used to describe varying cell membrane potential. The exponents were derived via voltage-clamped experiments in squid axons.

1. 
$$ C_m \frac {dV_m} {dt} = 
  \bar{G}_K n^4 (V_m - E_K) + 
  \bar{G}_{Na} m^3 h ( V_m - E_{Na} ) + 
  \bar{G}_L \cdot (V_m - E_L) +
  I_{app} $$
1. $$ \frac {dn} {dt} = \alpha_n (1 - n) - \beta_n n$$
2. $$\frac{dm}{dt} = \alpha_m (1 - m) - \beta_m m$$
3. $$\frac{dh}{dt}= \alpha_h (1 - h) - \beta_h h$$
where
- $\bar{G}$ is maximal conductance
- $n$ is a dimensionless probability in $[0, 1]$ of $K$ channel subunit activation
	- (in theory raised to 4th power because four subunits that require activation, but this was originally found empirically)
-  $m$ is a dimensionless probability in $[0, 1]$ of $Na$ channel subunit activation
- $h$ is a dimensionless probability in $[0, 1]$ of $Na$ channel subunit inactivation.
- $\alpha$ is a rate constant, dependent on membrane potential. (since steady state values depend on $V_m$)
$$ \alpha = \text{steady state value for activation}  / \tau$$
- $\beta$ is a rate constant, dependent on membrane potential.  
$$\beta = \text{steady state value for inactivation} / \tau $$
Note $\tau$ is a time constant for the relevant gating variable ($n$, $m$ or $h$).
Steady state values can be modelled differently (but always depends on $V_m$).

When the voltage-dependence of rate constants are known, the gating variables and dynamics in membrane potential can be simulated in response to external current.

## leaky integrate-and-fire model of spike events

A simpler alternative to producing spiking behaviour in single neurons (biophysics of voltage-gated channels are ignored). Membrane potential has a capacitance and leak term only; and is reset when it reaches spiking threshold.

Following simplification of the circuit model (where ion-channel conductances are fixed/ignored), we model current through the membrane using leaky channel term plus externally applied current.
$$I_m = C_m \frac{dV_m}{dt} = 
G_L (E_L -V_m) + I_{app} \ ;
\text{if } V_m > V_{thresh} \ \text{then }
V_m \mapsto V_{reset}$$
Without the conductance term, membrane potential would perfectly integrate the external current applied.

The steady state value for $V_m$ is found when $dV_m/dt = 0$.
$$V_{ss} = \frac {I_{app}} {G_L} + E_L$$
When $I_{app}$ is high enough, $V_{ss}$ reaches $V_{thresh}$. That is, this is the current needed to generate spikes and can be written as $I_{thresh}$, substituted into the above:
$$I_{thresh} = G_L(V_{thresh} - E_L)$$

### derivation of regular time between spikes in LIF models
$$ \tau_m \frac{du}{dt} = - u(t) + RI(t) $$
where
- $\tau_m$ = membrane time constant
- $u$ = membrane potential
- $R$ = membrane resistance
- $I$ = driving current through membrane

Spikes are characterised by their firing time $$t^{(f)} : u(t^{(f)}) = u_{th}$$where $u_{th}$ is a firing threshold.
Immediately after $t^{(f)}$, the potential is reset, following
$$\lim_{t \to t^{(f)} \space ; \space t > t^{(f)}} 
u(t) = u_r$$
where $u_r$ is the resting potential.

Suppose a spike occurs at $t = t^{(1)}$, where $I(t) = I_0$. The membrane potential at a time after $t^{(1)}$ is given by

$$u(t) = RI_0 \bigl( 1 - \exp ( - \frac{t - t^{(1)}} {\tau_m}) \bigr) $$
From the above, we have a spike at a point in time, if $RI_0 > u_{th}$, and no spike otherwise.

We can find the time taken $T= t^{(2)} - t^{(1)}$ for the membrane potential to reset, and another spike to occur, as follows.

$$u_{th} = RI_0 \bigl( 1 - \exp ( - \frac{t^{(2)} - t^{(1)}} {\tau_m}) \bigr) $$
$$ T = \tau_m \ln\frac{RI_0}{RI_0 - u_{th}} $$
This shows the regular spike pattern/oscillatory activity generated by the LIF model, with constant driving current.

## analysing spike trains (in single neurons)

> [!todo]
> keep going through Analysis of Individual Spike Trains chapter in Miller -> ROC curve stuff looks interesting.

**Observed spike trains are stochastic**

- without external stimulus, spike trains show high variability
- with external constant stimulus, there is still variability in resulting action potential sequence

### poisson point process

> [!todo]
> go back to slides, try to understand pulin's derivation thing here, + discussion of variability

- models a stochastic time series
$$ P_T[n]: \text{probability that $n$ spikes occur in time interval $T$}$$
- using a bin model and making some assumptions we arrive at...
$$P_T(n) = \frac{(rT)^n}{n!}e^{(-rT)} $$
- where T is a time interval
- r is a firing rate
- n is the number of bins in this interval

However real neural spike trains show greater variability than expected from a poisson distribution.

### fano factor

Consider fano factor: ratio of variance to mean (of the number of spikes within a given time window).

For varying time window lengths, fano factor of poisson model is 1; however in experimental data, fano factor can increase to 100 for a window of 100 seconds. So for longer time windows, variability for the number of spikes occuring increases, beyond a Poisson model of stochasticity. 

Similar observation: in cortical neurons, counting number of spikes in varying interval lengths, we observe a long right-tailed distribution. i.e. spike count rate increases in longer time windows.

### inter-spike Interval

the intervals between consecutive spike events.
$$T_i = t_{i+1} - t_i $$

**Co-efficient of Variation**:
$$C_V=\frac{(Var(T_i))^{1/2}}{\langle T_i \rangle} $$
$C_V$ is 1 for Poisson process.

Experimentally, ISIs fall in right-skewed distributions.

### neural response function

Simple way to calculate total response to a stimulus. 

We have a set of spike times, after some stimulus. 
$$ S = \{t_1, t_2, \ldots , t_n \} $$
Total **neural response** in a time interval can then be represented by summing times since previous spikes. $\delta$ is dirac delta function (?) 
$$ \rho (t) = \sum_{i=1}^{n}\delta(t - t_i) $$
### spike count rate

**spike-count rate** counts the number of spikes in a time interval, divided by time interval. This is equivalent to average neural response?
$$r = \frac{n}{T} = \frac{1}{T}\int_0^{T}\rho(\tau)\,d\tau$$
### firing rate (or 'spike density')

Choose a time bin width. Count the number of spikes in each time bin, averaged across all trials
for this neuron. Divide each count by width of time bin. Now you have firing rate as a function of time.

**firing rate (averaged across trials)** 
$$r(t)=\frac{1}{\triangle t}\int_t^{t+\triangle t}\langle \rho(\tau)\rangle \, d\tau $$
### average firing rate (or 'population activity')

This is the firing rate, but, in each time bin (or, as written below, for one time window), you find average spike count across population, instead of across trials.

 **firing rate (averaged across population)**
$$\langle r \rangle= \frac{\langle n \rangle}{T} = \frac{1}{T}\int_0^{T}\langle\rho(\tau)\rangle\,d\tau = \frac{1}{T}\int_0^Tr(\tau) \, d\tau$$
### reverse correlation

This is a spike triggered average (average number of stimuli per spike within some time window e.g. 100 ms).

Has been shown that spike triggered average can be used for stimulus reconstruction, indicating fundamentally that time-varying input to a single neuron is indeed encoded by its spike times.



